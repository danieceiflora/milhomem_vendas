{% extends 'base.html' %}

{% block title %}
Detalhes da Venda #{{ object.id }}
{% endblock %}

{% block content %}
<div class="mb-8">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold bg-gradient-to-r from-rose-400 via-orange-400 to-rose-400 bg-clip-text text-transparent">
        Detalhes da Venda
      </h1>
      <p class="text-muted-foreground mt-2">Visualize todas as informações desta venda registrada</p>
    </div>
    <div class="flex items-center space-x-2">
      <div class="h-2 w-2 bg-rose-500 rounded-full animate-pulse"></div>
  <span class="text-sm text-muted-foreground">Venda #{{ object.id }}</span>
    </div>
  </div>
</div>

<div class="max-w-6xl mx-auto">
  <div class="rounded-lg border border-border bg-gradient-to-br from-rose-500/10 via-orange-500/5 to-rose-500/10 p-8 glass-effect space-y-8">
    <div class="flex items-center space-x-4">
      <div class="h-16 w-16 bg-gradient-to-r from-rose-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
        <i data-lucide="shopping-cart" class="h-8 w-8 text-white"></i>
      </div>
      <div>
        <h2 class="text-2xl font-bold text-primary">{{ object.customer.full_name }}</h2>
        <p class="text-muted-foreground">CPF {{ object.customer.formatted_cpf }} · {{ object.created_at|date:"d/m/Y H:i" }}</p>
        <div class="mt-3 flex flex-wrap gap-2 text-xs uppercase tracking-wide text-muted-foreground">
          <span class="inline-flex items-center rounded-full bg-rose-500/20 px-3 py-1 text-rose-300">
            Tipo: Venda
          </span>
          {% if object.payment_method %}
            <span class="inline-flex items-center rounded-full bg-orange-500/20 px-3 py-1 text-orange-300">
              Pagamento: {{ object.payment_method.name }} ({{ object.payment_discount_percentage|floatformat:2 }}%)
            </span>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="package" class="h-4 w-4 text-rose-400"></i>
          <span>Itens vendidos</span>
        </div>
        <p class="text-2xl font-semibold">{{ total_items }} unidade(s)</p>
      </div>
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="banknote" class="h-4 w-4 text-emerald-400"></i>
          <span>Valor bruto</span>
        </div>
        <p class="text-2xl font-semibold {% if total_amount < 0 %}text-rose-400{% else %}text-emerald-400{% endif %}">R$ {{ total_amount|floatformat:2 }}</p>
      </div>
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="badge-percent" class="h-4 w-4 text-amber-300"></i>
          <span>Desconto</span>
        </div>
        <p class="text-2xl font-semibold text-amber-300">R$ {{ discount_amount|floatformat:2 }}</p>
      </div>
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="wallet" class="h-4 w-4 text-orange-400"></i>
          <span>Valor final</span>
        </div>
        <p class="text-2xl font-semibold {% if final_amount < 0 %}text-rose-400{% else %}text-emerald-300{% endif %}">R$ {{ final_amount|floatformat:2 }}</p>
      </div>
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="coins" class="h-4 w-4 text-orange-400"></i>
          <span>Custo total</span>
        </div>
        <p class="text-2xl font-semibold text-orange-400">R$ {{ total_cost|floatformat:2 }}</p>
      </div>
      <div class="rounded-lg border border-border/40 bg-secondary/30 p-4">
        <div class="flex items-center space-x-2 text-muted-foreground mb-2">
          <i data-lucide="trending-up" class="h-4 w-4 text-sky-400"></i>
          <span>Lucro</span>
        </div>
        <p class="text-2xl font-semibold {% if total_profit < 0 %}text-rose-400{% else %}text-sky-400{% endif %}">R$ {{ total_profit|floatformat:2 }}</p>
      </div>
    </div>

    <div class="rounded-lg border border-border/40 bg-secondary/20">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-border">
              <th class="h-12 px-4 text-left text-sm font-medium text-muted-foreground">Produto</th>
              <th class="h-12 px-4 text-left text-sm font-medium text-muted-foreground">Quantidade</th>
              <th class="h-12 px-4 text-left text-sm font-medium text-muted-foreground">Preço unitário</th>
              <th class="h-12 px-4 text-left text-sm font-medium text-muted-foreground">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
              <tr class="border-b border-border/60">
                <td class="px-4 py-3">
                  <div class="font-medium">{{ item.product.title }}</div>
                  <div class="text-xs text-muted-foreground">Marca {{ item.product.brand }} · Categoria {{ item.product.category }}</div>
                </td>
                <td class="px-4 py-3">{{ item.quantity }} un.</td>
                <td class="px-4 py-3">R$ {{ item.unit_price|floatformat:2 }}</td>
                <td class="px-4 py-3 text-emerald-400 font-semibold">R$ {{ item.subtotal|floatformat:2 }}</td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="4" class="px-4 py-6 text-center text-muted-foreground">Nenhum item registrado para esta venda.</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    {% if object.description %}
      <div class="rounded-lg border border-border/40 bg-secondary/20 p-4">
        <div class="flex items-center space-x-2 mb-2">
          <i data-lucide="file-text" class="h-4 w-4 text-rose-400"></i>
          <span class="text-sm font-medium text-muted-foreground">Observações</span>
        </div>
        <p class="text-sm leading-relaxed text-foreground">{{ object.description|linebreaks }}</p>
      </div>
    {% endif %}

    <div class="flex justify-end">
      <a href="{% url 'outflow_list' %}" class="inline-flex items-center space-x-2 bg-secondary hover:bg-secondary/80 text-secondary-foreground px-4 py-2 rounded-lg font-medium transition-all duration-200">
        <i data-lucide="arrow-left" class="h-4 w-4"></i>
        <span>Voltar</span>
      </a>
    </div>
  </div>
</div>
{% endblock %}

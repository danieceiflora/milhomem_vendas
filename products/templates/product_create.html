{% extends 'base.html' %}

{% block title %}
  SGE - Novo Produto
{% endblock %}

{% block content %}

<!-- Page Header -->
<div class="mb-8">
  <div class="flex items-center space-x-4">
    <a href="{% url 'product_list' %}" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 w-10">
      <i data-lucide="arrow-left" class="w-4 h-4"></i>
    </a>
    <div>
      <h1 class="text-3xl font-bold bg-gradient-to-r from-blue-400 via-purple-400 to-blue-400 bg-clip-text text-transparent">
        Novo Produto
      </h1>
      <p class="text-muted-foreground mt-2">Cadastre um novo produto para o seu estoque</p>
    </div>
  </div>
</div>

<!-- Form Card -->
<div class="max-w-4xl">
  <div class="rounded-lg border border-border bg-card p-6 glass-effect">
    <div class="flex items-center space-x-2 mb-6">
      <div class="w-8 h-8 bg-gradient-to-r from-blue-500/20 to-purple-600/20 rounded-lg flex items-center justify-center">
        <i data-lucide="package" class="w-4 h-4 text-blue-400"></i>
      </div>
      <h2 class="text-xl font-semibold">Informações do Produto</h2>
    </div>

    <form method="post" enctype="multipart/form-data" class="space-y-6">
      {% csrf_token %}
      
      <!-- Form Fields -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        {% for field in form %}
          <div class="space-y-2 {% if field.name == 'description' %}md:col-span-2{% endif %}">
            <label for="{{ field.id_for_label }}" class="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70">
              {{ field.label }}
              {% if field.field.required %}
                <span class="text-destructive">*</span>
              {% endif %}
            </label>
            
            {% if field.name == 'description' %}
              <textarea 
                id="{{ field.id_for_label }}"
                name="{{ field.name }}"
                placeholder="{{ field.field.widget.attrs.placeholder|default:'Descreva o produto...' }}"
                class="flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 resize-none"
                {% if field.field.required %}required{% endif %}
              >{{ field.value|default:'' }}</textarea>
            {% elif field.name == 'image' %}
              <div class="space-y-3">
                <input 
                  type="file"
                  id="{{ field.id_for_label }}"
                  name="{{ field.name }}"
                  accept="image/*"
                  class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                  {% if field.field.required %}required{% endif %}
                  onchange="previewImage(this)"
                >
                <div id="image-preview" class="hidden mt-3">
                  <img src="" alt="Preview" class="max-w-xs rounded-lg border border-border shadow-sm">
                </div>
              </div>
            {% elif field.name == 'category' or field.name == 'brand' or field.name == 'supplier' %}
              <select 
                id="{{ field.id_for_label }}"
                name="{{ field.name }}"
                class="flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                {% if field.field.required %}required{% endif %}
              >
                <option value="">Selecione...</option>
                {% for choice in field.field.choices %}
                  {% if choice.0 %}
                    <option value="{{ choice.0 }}" {% if field.value == choice.0 %}selected{% endif %}>{{ choice.1 }}</option>
                  {% endif %}
                {% endfor %}
              </select>
            {% else %}
              <input 
                type="{{ field.field.widget.input_type|default:'text' }}"
                id="{{ field.id_for_label }}"
                name="{{ field.name }}"
                value="{{ field.value|default:'' }}"
                placeholder="{{ field.field.widget.attrs.placeholder|default:'Digite o '|add:field.label|lower }}"
                class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"
                {% if field.field.required %}required{% endif %}
                {% if field.name == 'cost_price' or field.name == 'selling_price' %}step="0.01" min="0"{% endif %}
                {% if field.name == 'quantity' %}min="0"{% endif %}
              >
            {% endif %}
            
            {% if field.errors %}
              <div class="text-sm font-medium text-destructive">
                {% for error in field.errors %}
                  <p>{{ error }}</p>
                {% endfor %}
              </div>
            {% endif %}
            
            {% if field.help_text %}
              <p class="text-sm text-muted-foreground">{{ field.help_text }}</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>

      <!-- Form Actions -->
      <div class="flex items-center space-x-4 pt-4 border-t border-border">
        <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-10 px-4 py-2">
          <i data-lucide="save" class="w-4 h-4 mr-2"></i>
          Salvar Produto
        </button>
        <a href="{% url 'product_list' %}" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-10 px-4 py-2">
          <i data-lucide="x" class="w-4 h-4 mr-2"></i>
          Cancelar
        </a>
      </div>
    </form>
  </div>
</div>

<script>
function previewImage(input) {
  const preview = document.getElementById('image-preview');
  const img = preview.querySelector('img');
  
  if (input.files && input.files[0]) {
    const reader = new FileReader();
    
    reader.onload = function(e) {
      img.src = e.target.result;
      preview.classList.remove('hidden');
    };
    
    reader.readAsDataURL(input.files[0]);
  } else {
    preview.classList.add('hidden');
  }
}
</script>

{% endblock %}
